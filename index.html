<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2Days - Miss once, never twice</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="49 günlük alışkanlık takip uygulaması. Disiplin + Esneklik = Kalıcı Alışkanlık">
    <meta name="theme-color" content="#00ff88">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="2Days">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden; /* Yatay kaydırmayı engelle */
            -webkit-overflow-scrolling: touch; /* iOS smooth scroll */
            margin: 0;
        }

        /* Mobil için padding azalt */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
        }

        * {
            -webkit-tap-highlight-color: transparent; /* Mobil tıklama efektini kaldır */
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 80px; /* Footer için boşluk */
            width: 100%; /* Mobil genişlik */
            overflow-x: hidden; /* Container kaymasını engelle */
        }

        /* Debug Mode - now in About modal */

        .debug-info {
            position: fixed;
            top: 70px;
            right: 20px;
            background: rgba(255, 140, 0, 0.95);
            border: 2px solid #ff8c00;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.85em;
            z-index: 1001;
            display: none;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.6);
            min-width: 200px;
        }

        .debug-info.active {
            display: block;
        }

        /* Dashboard Screen */
        .dashboard-screen {
            display: none;
            padding: 20px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
            padding: 60px 20px;
            background: radial-gradient(circle at center, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
        }

        .dashboard-header h1 {
            font-size: 5em;
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 50%, #00ff88 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 900;
            letter-spacing: 5px;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 60px rgba(0, 255, 136, 0.4);
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px rgba(0, 255, 136, 0.6)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 30px rgba(0, 255, 136, 0.8)); }
        }

        .dashboard-header .slogan {
            color: #a0a0a0;
            font-size: 1.4em;
            font-style: italic;
            letter-spacing: 3px;
            margin-top: 10px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            font-weight: 300;
        }

        .dashboard-header .tagline {
            color: #00ff88;
            font-size: 1.1em;
            margin-top: 25px;
            font-weight: 600;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .dashboard-header p {
            color: #a0a0a0;
            font-size: 1.2em;
        }

        .quest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .quest-card {
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .quest-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .quest-card.completed {
            border-color: #ffd700;
        }

        .quest-card.failed {
            border-color: #ff4444;
            opacity: 0.8;
        }

        .quest-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            gap: 10px;
        }

        .btn-delete-quest {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .btn-delete-quest:hover {
            background: rgba(255, 68, 68, 0.4);
            transform: scale(1.05);
        }

        .quest-title-card {
            font-size: 1.3em;
            color: #00ff88;
            font-weight: bold;
            flex: 1;
        }

        .quest-status-badge {
            font-size: 0.85em;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            white-space: nowrap;
        }

        .quest-status-badge.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .quest-status-badge.success {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }

        .quest-status-badge.failed {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .quest-reward-card {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .quest-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .progress-fill {
            background: linear-gradient(90deg, #00ff88 0%, #00cc6a 100%);
            height: 100%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 0.9em;
        }

        .quest-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #a0a0a0;
            flex-wrap: wrap;
        }

        .btn-new-quest-dash {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
            border: none;
            padding: 22px 50px;
            font-size: 1.4em;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
            width: 100%;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-new-quest-dash::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-new-quest-dash:hover::before {
            width: 400px;
            height: 400px;
        }

        .btn-new-quest-dash:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(0, 255, 136, 0.6);
        }

        .btn-new-quest-dash:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-new-quest-dash:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.6);
        }

        .btn-view-archive {
            background: linear-gradient(135deg, #ba55d3 0%, #8b008b 100%);
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-view-archive:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(186, 85, 211, 0.4);
        }

        .empty-dashboard {
            text-align: center;
            padding: 80px 20px;
            color: #a0a0a0;
        }

        .empty-dashboard h2 {
            font-size: 2em;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .empty-dashboard p {
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        /* Rules Section */
        .rules-section {
            background: rgba(26, 26, 46, 0.6);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 30px;
        }

        .rules-section h3 {
            color: #00ff88;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rules-list li {
            color: #e0e0e0;
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
            line-height: 1.6;
        }

        .rules-list li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: #00ff88;
            font-weight: bold;
        }

        /* Tab Buttons */
        .tab-button {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid rgba(0, 255, 136, 0.3);
            color: #a0a0a0;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05em;
            transition: all 0.3s;
            flex: 1;
        }

        .tab-button:hover {
            background: rgba(0, 255, 136, 0.15);
            border-color: rgba(0, 255, 136, 0.5);
        }

        .tab-button.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Info Buttons */
        .info-buttons-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 35px;
        }

        .info-button {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 200, 100, 0.1));
            border: 3px solid #00ff88;
            color: #00ff88;
            padding: 20px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3),
                        inset 0 0 20px rgba(0, 255, 136, 0.1);
        }

        .info-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 255, 136, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .info-button:hover::before {
            width: 400px;
            height: 400px;
        }

        .info-button:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.25), rgba(0, 200, 100, 0.15));
            transform: translateY(-5px);
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.6),
                        0 0 60px rgba(0, 255, 136, 0.4),
                        inset 0 0 30px rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }

        .info-button span {
            position: relative;
            z-index: 1;
        }

        /* Info Modal */
        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .info-modal.active {
            display: flex;
        }

        .info-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #00ff88;
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.5);
        }

        .info-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5em;
            color: #ff4444;
            transition: all 0.3s;
            font-weight: bold;
        }

        .info-modal-close:hover {
            background: rgba(255, 68, 68, 0.4);
            transform: scale(1.1);
        }

        .info-modal h2 {
            color: #00ff88;
            font-size: 2em;
            margin-bottom: 25px;
            text-align: center;
        }

        /* Footer */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: rgba(26, 26, 46, 0.95);
            border-top: 1px solid rgba(0, 255, 136, 0.2);
            text-align: center;
            z-index: 100;
        }

        .footer-button {
            background: transparent;
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #a0a0a0;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .footer-button:hover {
            border-color: #00ff88;
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        /* About Modal */
        .about-content {
            text-align: center;
        }

        .about-content .version {
            display: inline-block;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 200, 100, 0.1));
            border: 2px solid #00ff88;
            padding: 10px 25px;
            border-radius: 25px;
            color: #00ff88;
            font-weight: 600;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .about-content .developer {
            font-size: 1.3em;
            color: #e0e0e0;
            margin: 25px 0 15px 0;
        }

        .about-content .contact {
            color: #00ff88;
            font-size: 1.1em;
            margin: 15px 0;
        }

        .about-content .contact a {
            color: #00ff88;
            text-decoration: none;
            transition: all 0.3s;
        }

        .about-content .contact a:hover {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.6);
        }

        .test-mode-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid rgba(0, 255, 136, 0.2);
        }

        .test-mode-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
        }

        .test-mode-input input {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
            width: 200px;
        }

        .test-mode-input input:focus {
            outline: none;
            border-color: #00ff88;
        }

        .test-mode-input button {
            padding: 10px 25px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-mode-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        /* Data Management Section */
        .data-management {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid rgba(0, 255, 136, 0.2);
        }

        .data-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .data-buttons button {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #00ff88;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-export {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 200, 100, 0.1));
            color: #00ff88;
        }

        .btn-export:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 200, 100, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .btn-import {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            color: #ffd700;
            border-color: #ffd700;
        }

        .btn-import:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* Custom Confirm Modal */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .confirm-modal.active {
            display: flex;
        }

        .confirm-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #ff4444;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
        }

        .confirm-modal h3 {
            color: #ff4444;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .confirm-modal p {
            color: #e0e0e0;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .confirm-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-confirm-yes {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        .btn-confirm-no {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 2px solid #00ff88;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        .btn-confirm-yes:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff0000 100%);
        }

        .btn-confirm-no:hover {
            background: rgba(0, 255, 136, 0.3);
        }

        /* Back Button */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 200, 100, 0.15));
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s;
            z-index: 150;
            display: none;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
        }

        .back-button:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.25), rgba(0, 200, 100, 0.25));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.3);
        }

        .back-button.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button::before {
            content: "◄";
            font-size: 1.2em;
        }

        /* Setup Screen */
        .setup-screen {
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        .setup-screen h1 {
            font-size: 3.5em;
            color: #00ff88;
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            font-weight: 900;
            letter-spacing: 2px;
        }

        .setup-screen .slogan {
            color: #a0a0a0;
            font-size: 1.1em;
            font-style: italic;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .setup-screen p {
            color: #a0a0a0;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .input-group label {
            display: block;
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.15em;
            letter-spacing: 0.5px;
        }

        .input-group input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            color: #e0e0e0;
            font-size: 1.2em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            background: rgba(0, 255, 136, 0.15);
        }

        .input-group input::placeholder {
            color: #888;
            font-weight: 400;
        }

        .input-group input[type="date"] {
            color-scheme: dark;
        }

        .input-group input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .btn-start {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.6);
        }

        .btn-history {
            background: linear-gradient(135deg, #ba55d3 0%, #8b008b 100%);
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(186, 85, 211, 0.4);
            margin-top: 15px;
        }

        .btn-history:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(186, 85, 211, 0.6);
        }

        /* History Screen */
        .history-screen {
            display: none;
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #ba55d3;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(186, 85, 211, 0.3);
        }

        .history-screen h1 {
            font-size: 2em;
            color: #ba55d3;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(186, 85, 211, 0.5);
        }

        .history-list {
            margin-bottom: 20px;
        }

        .history-item {
            background: rgba(186, 85, 211, 0.1);
            border: 2px solid #ba55d3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item-info {
            flex: 1;
        }

        .history-item-title {
            font-size: 1.3em;
            color: #00ff88;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .history-item-date {
            color: #a0a0a0;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .history-item-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .history-stat {
            font-size: 0.9em;
        }

        .history-stat.success {
            color: #00ff88;
        }

        .history-stat.failed {
            color: #ff4444;
        }

        .btn-delete-history {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-delete-history:hover {
            background: rgba(255, 68, 68, 0.4);
            transform: scale(1.05);
        }

        .btn-back {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 20px auto 0;
        }

        .btn-back:hover {
            transform: translateY(-2px);
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
            font-size: 1.2em;
        }

        /* Game Screen */
        .game-screen {
            display: none;
            position: relative;
        }

        .header {
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .quest-title {
            font-size: 1.8em;
            color: #00ff88;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .reward-text {
            color: #ffd700;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .date-info {
            color: #00ffff;
            font-size: 1em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            color: #00ff88;
            font-weight: bold;
        }

        .streak-bar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            margin-top: 8px;
            position: relative;
        }

        .streak-bar {
            background: linear-gradient(90deg, #00ff88 0%, #00cc6a 100%);
            height: 100%;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .streak-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.85em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Alert Messages */
        .alert-box {
            background: rgba(255, 68, 68, 0.9);
            border: 2px solid #ff4444;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .alert-7g {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.9), rgba(255, 165, 0, 0.9));
            border-color: #ffa500;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.4);
        }

        /* Grid Map */
        .grid-container {
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .grid-map {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            width: 100%; /* Mobil tam genişlik */
            overflow: hidden; /* Taşmayı engelle */
        }

        /* Mobil için daha küçük gap */
        @media (max-width: 600px) {
            .grid-map {
                gap: 6px;
            }
            
            .grid-cell {
                padding: 4px 2px;
                font-size: 0.9em;
            }
        }

        .grid-cell {
            aspect-ratio: 1;
            background: rgba(60, 60, 80, 0.4);
            border: 2px solid #505070;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            padding: 8px 4px;
            color: #e0e0e0;
        }

        .grid-cell:hover:not(.locked) {
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
            z-index: 10;
        }

        /* Completed */
        .grid-cell.completed {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.5), rgba(0, 200, 100, 0.6));
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            color: #ffffff;
        }

        .grid-cell.completed .status-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7em;
            color: #ffffff;
            background: rgba(0, 0, 0, 0.2);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Empty */
        .grid-cell.empty {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.6), rgba(100, 0, 0, 0.7));
            border-color: #8b0000;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.4);
            color: #ffcccc;
        }

        /* EPIC JOKER - Purple/Magenta Gradient */
        .grid-cell.joker {
            background: linear-gradient(135deg, 
                rgba(138, 43, 226, 0.8),  /* Blue Violet */
                rgba(186, 85, 211, 0.8),  /* Medium Orchid */
                rgba(255, 20, 147, 0.8)   /* Deep Pink/Magenta */
            );
            border: 3px solid #ff1493;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.7), 0 0 50px rgba(138, 43, 226, 0.5);
            color: #ffffff;
            animation: epicJokerGlow 3s infinite;
        }

        @keyframes epicJokerGlow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(255, 20, 147, 0.7), 0 0 50px rgba(138, 43, 226, 0.5);
                border-color: #ff1493;
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 20, 147, 0.9), 0 0 70px rgba(138, 43, 226, 0.7);
                border-color: #ba55d3;
            }
        }

        .grid-cell.joker .joker-icon-large {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.2em;
            opacity: 0.3;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
        }

        .grid-cell.joker .status-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.85em;
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.8));
        }

        /* 7G Mode - Green-Orange Flame Mix */
        .grid-cell.seven-g {
            background: linear-gradient(135deg, 
                rgba(0, 255, 136, 0.6),   /* Yeşil */
                rgba(255, 215, 0, 0.6),   /* Altın */
                rgba(255, 140, 0, 0.7)    /* Turuncu */
            );
            border-color: #ffa500;
            box-shadow: 0 0 25px rgba(255, 165, 0, 0.7), 0 0 45px rgba(0, 255, 136, 0.4);
            color: #ffffff;
            animation: greenOrangeFireGlow 2s infinite;
        }

        @keyframes greenOrangeFireGlow {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(255, 165, 0, 0.7), 0 0 45px rgba(0, 255, 136, 0.4);
                border-color: #ff8c00;
            }
            50% { 
                box-shadow: 0 0 35px rgba(255, 165, 0, 0.9), 0 0 60px rgba(0, 255, 136, 0.6);
                border-color: #00ff88;
            }
        }

        .grid-cell.seven-g .status-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7em;
        }

        .grid-cell.today {
            border: 3px solid #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        }

        .grid-cell.locked {
            background: rgba(40, 40, 50, 0.3);
            border-color: #404050;
            color: #606070;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .grid-cell.locked:hover {
            transform: none;
            box-shadow: none;
        }

        .grid-cell.locked .status-icon {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.65em;
            opacity: 0.5;
        }

        body.debug-mode .grid-cell.locked {
            background: rgba(60, 60, 80, 0.4);
            border-color: #ff8c00;
            opacity: 0.8;
            cursor: pointer;
        }

        body.debug-mode .grid-cell.locked:hover {
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.6);
        }

        /* Cell Content - Vertical, NO large icons */
        .cell-day-number {
            font-size: 1.4em;
            font-weight: 700;
            line-height: 1;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
            margin-bottom: 2px;
        }

        .cell-month {
            font-size: 0.65em;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            margin-bottom: 2px;
        }

        .cell-weekday {
            font-size: 0.55em;
            font-weight: 400;
            opacity: 0.7;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Overlay with Blur for Game Over/Success */
        .game-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }

        .game-overlay.active {
            display: flex;
        }

        .overlay-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 50px;
            animation: scaleIn 0.4s;
            position: relative;
            z-index: 501;
        }

        .overlay-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5em;
            color: #ff4444;
            transition: all 0.3s;
            font-weight: bold;
        }

        .overlay-close:hover {
            background: rgba(255, 68, 68, 0.4);
            transform: scale(1.1);
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .overlay-content.game-over {
            border-color: #ff4444;
            box-shadow: 0 0 50px rgba(255, 68, 68, 0.6);
        }

        .overlay-content.success {
            border-color: #00ff88;
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.6);
        }

        .overlay-content h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .overlay-content.game-over h1 {
            color: #ff4444;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.8);
        }

        .overlay-content.success h1 {
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
        }

        .overlay-content p {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .overlay-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Bottom Sheet Menu */
        .bottom-sheet-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .bottom-sheet-overlay.active {
            display: block;
        }

        .bottom-sheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px 20px 0 0;
            padding: 25px;
            z-index: 1000;
            box-shadow: 0 -5px 30px rgba(0, 255, 136, 0.3);
            transition: bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 70vh;
            overflow-y: auto;
        }

        .bottom-sheet.active {
            bottom: 0;
        }

        .bottom-sheet-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
        }

        .bottom-sheet-title {
            font-size: 1.4em;
            color: #00ff88;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .bottom-sheet-subtitle {
            font-size: 0.95em;
            color: #a0a0a0;
        }

        .bottom-sheet-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .bottom-sheet-option {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bottom-sheet-option:hover {
            background: rgba(0, 255, 136, 0.2);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .bottom-sheet-option.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            border-color: #505060;
        }

        .bottom-sheet-option.disabled:hover {
            transform: none;
            background: rgba(0, 255, 136, 0.1);
            box-shadow: none;
        }

        .option-icon {
            font-size: 1.8em;
            width: 40px;
            text-align: center;
        }

        .option-content {
            flex: 1;
        }

        .option-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 3px;
        }

        .option-desc {
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .option-warning {
            font-size: 0.75em;
            color: #ff8c00;
            margin-top: 3px;
        }

        /* Action Buttons */
        .action-button {
            padding: 15px 35px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #fff;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 68, 68, 0.6);
        }

        .btn-new-quest {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        .btn-new-quest:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.6);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.4);
        }

        .modal-content h2 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .modal-content p {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-yes {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
        }

        .modal-btn-no {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #fff;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .legend-box {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid;
        }

        .legend-box.completed {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.5), rgba(0, 200, 100, 0.6));
            border-color: #00ff88;
        }

        .legend-box.empty {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.6), rgba(100, 0, 0, 0.7));
            border-color: #8b0000;
        }

        .legend-box.joker {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.8), rgba(255, 20, 147, 0.8));
            border-color: #ff1493;
        }

        .legend-box.seven-g {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.6), rgba(255, 215, 0, 0.6), rgba(255, 140, 0, 0.7));
            border-color: #ffa500;
        }

        /* Celebration styles */
        .celebration-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .celebration-overlay.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .celebration-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            animation: scaleIn 0.5s;
            position: relative;
        }

        .celebration-card h1 {
            font-size: 3em;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .celebration-card p {
            font-size: 1.5em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .celebration-joker {
            font-size: 5em;
            margin: 20px 0;
            animation: bounce 1s infinite;
        }

        .btn-continue {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a2e;
            border: none;
            padding: 15px 40px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
            z-index: 2001;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Streak 14 cell glow */
        .grid-cell.streak-14 {
            animation: streak14Glow 2s infinite;
            border: 3px solid #ffd700 !important;
        }

        @keyframes streak14Glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 215, 0, 0.8);
            }
        }

        /* Joker count pulse */
        .joker-pulse {
            animation: jokerPulse 0.5s;
        }

        @keyframes jokerPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); color: #ffd700; }
            100% { transform: scale(1); }
        }

        @media (max-width: 600px) {
            .debug-toggle {
                top: 10px;
                right: 10px;
            }

            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .grid-map {
                gap: 6px;
            }
            
            .grid-cell {
                padding: 5px 3px;
            }

            .cell-day-number {
                font-size: 1.2em;
            }

            .cell-month {
                font-size: 0.6em;
            }

            .cell-weekday {
                font-size: 0.5em;
            }

            .overlay-content {
                max-width: 90%;
                padding: 30px 20px;
            }

            .overlay-content h1 {
                font-size: 2.2em;
            }
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        ⚠️ Test Modu Aktif<br>
        Tüm günler düzenlenebilir
    </div>

    <!-- Info Modal -->
    <div class="info-modal" id="infoModal">
        <div class="info-modal-content">
            <div class="info-modal-close" onclick="closeInfoModal()">×</div>
            <div id="infoModalContent"></div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <h3>⚠️ Quest'i Sil?</h3>
            <p id="confirmMessage">Bu quest'i silmek istediğinize emin misiniz?</p>
            <div class="confirm-modal-buttons">
                <button class="btn-confirm-yes" id="btnConfirmYes">Evet, Sil</button>
                <button class="btn-confirm-no" id="btnConfirmNo">İptal</button>
            </div>
        </div>
    </div>

    <!-- Back to Dashboard Button -->
    <button class="back-button" id="backButton" onclick="goToDashboard()">
        Ana Sayfa
    </button>

    <div class="container">
        <!-- Dashboard Screen -->
        <div class="dashboard-screen" id="dashboardScreen">
            <div class="dashboard-header">
                <h1>2Days</h1>
                <div class="slogan">Miss once, never twice</div>
                <div class="tagline">⚡ Zinciri Koru • Disiplini İnşa Et</div>
            </div>

            <div class="info-buttons-container">
                <button class="info-button" onclick="openRulesModal()">
                    <span>📋 Nasıl Çalışır</span>
                </button>
                <button class="info-button" onclick="openMotivationModal()">
                    <span>💪 Motivasyon</span>
                </button>
            </div>

            <button class="btn-new-quest-dash" onclick="showNewQuestSetup()">
                <span style="position: relative; z-index: 1;">➕ Yeni Quest Başlat</span>
            </button>

            <div id="activeQuestsContainer"></div>

            <button class="btn-view-archive" onclick="showArchive()">
                📜 Tamamlanan Questleri Görüntüle
            </button>
        </div>

        <!-- Original Container Content -->
        <div class="setup-screen" id="setupScreen">
            <h1>2Days</h1>
            <div class="slogan">Miss once, never twice</div>
            
            <div class="input-group">
                <label>📅 Başlangıç Tarihi</label>
                <input type="date" id="startDateInput" required>
            </div>

            <div class="input-group">
                <label>⚔️ Alışkanlık Hedefi (Günlük Quest)</label>
                <input type="text" id="habitInput" placeholder="Örn: 20 dakika kitap okuma" maxlength="100">
            </div>
            
            <div class="input-group">
                <label>🏆 Büyük Ödül (49 Gün Sonrası)</label>
                <input type="text" id="rewardInput" placeholder="Örn: Yeni bir oyun almak" maxlength="100">
            </div>
            
            <button class="btn-start" onclick="startQuest()">Maceraya Başla</button>
            <button class="btn-history" onclick="showHistory()">📜 Geçmiş Maceralarım</button>
        </div>

        <!-- History Screen -->
        <div class="history-screen" id="historyScreen">
            <h1>📜 Geçmiş Maceralarım</h1>
            <div class="history-list" id="historyList"></div>
            <button class="btn-back" onclick="backToSetup()">← Ana Sayfaya Dön</button>
        </div>

        <div class="game-screen" id="gameScreen">
            <div class="header">
                <div class="quest-title" id="questTitle">⚔️ Quest Yükleniyor...</div>
                <div class="reward-text" id="rewardText">🏆 Ödül: ---</div>
                <div class="date-info" id="dateInfo">
                    📅 Başlangıç: ---<br>
                    🎯 Hedef Bitiş: ---
                </div>
                
                <div class="stats-panel">
                    <div class="stat-box">
                        <div class="stat-label">Bugün</div>
                        <div class="stat-value" id="currentDate" style="font-size: 0.9em; line-height: 1.3;">---</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">🃏 Joker</div>
                        <div class="stat-value" id="jokerCount">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">⚡ Streak</div>
                        <div class="stat-value" id="streakCount">0</div>
                        <div class="streak-bar-container">
                            <div class="streak-bar" id="streakBar"></div>
                            <div class="streak-text" id="streakText">0/14</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="alertContainer"></div>

            <div class="grid-container">
                <div class="grid-map" id="gridMap"></div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box completed"></div>
                        <span>Tamamlandı</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box empty"></div>
                        <span>Boş Geçildi</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box joker"></div>
                        <span>Joker (Epic)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box seven-g"></div>
                        <span>7G Görevi</span>
                    </div>
                </div>
                
                <button class="action-button" style="width: 100%; margin-top: 15px; background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%); color: #1a1a2e;" onclick="goToDashboard()">
                    ← Ana Sayfa
                </button>
            </div>
        </div>
    </div>

    <div class="game-overlay" id="gameOverlay">
        <div class="overlay-content" id="overlayContent">
            <div class="overlay-close" onclick="closeOverlayWithAutoArchive()">×</div>
            <h1 id="overlayTitle">---</h1>
            <p id="overlayMessage">---</p>
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="bottomSheetOverlay" onclick="closeBottomSheet()"></div>
    <div class="bottom-sheet" id="bottomSheet">
        <div class="bottom-sheet-header">
            <div class="bottom-sheet-title" id="sheetTitle">Gün Seçin</div>
            <div class="bottom-sheet-subtitle" id="sheetSubtitle">---</div>
        </div>
        <div class="bottom-sheet-options" id="sheetOptions"></div>
    </div>

    <div class="modal" id="jokerModal">
        <div class="modal-content">
            <h2>🃏 Joker Kullanmak İster Misiniz?</h2>
            <p>İki gün üst üste quest tamamlanmadı. Bir joker kullanarak devam edebilir veya 7G Kurtarma Görevi'ne başlayabilirsiniz.</p>
            <p style="color: #ffd700; font-weight: bold;">Mevcut Joker: <span id="modalJokerCount"></span></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-yes" onclick="useJokerAuto()">Joker Kullan</button>
                <button class="modal-btn modal-btn-no" onclick="start7G()">7G Görevine Başla</button>
            </div>
        </div>
    </div>

    <!-- Celebration Overlay for 14 Streak -->
    <div class="celebration-overlay" id="celebrationOverlay">
        <div class="celebration-card">
            <h1>🎉 Muhteşem! 🎉</h1>
            <div class="celebration-joker">🃏</div>
            <p>
                <strong>14 Gün Streak Tamamlandı!</strong><br>
                +1 Joker Kazandınız!
            </p>
            <button class="btn-continue" onclick="closeCelebration()">Devam Et</button>
        </div>
    </div>

    <script>
        // Multi-Quest System
        let multiQuestData = {
            activeQuests: [],
            archivedQuests: [],
            currentQuestId: null
        };

        let gameState = {
            habitGoal: '',
            bigReward: '',
            startDate: null,
            endDate: null,
            days: [],
            jokerCount: 1,
            currentStreak: 0,
            sevenGActive: false,
            sevenGProgress: 0,
            sevenGStartDate: null,
            sevenGUsed: false,
            lastJokerDay: null,
            streakRewards: [],
            gameStatus: 'active',
            pendingTwoEmptyDays: null
        };

        let selectedDayIndex = null;
        let debugMode = false;

        function formatDateFull(dateStr) {
            const months = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
            const days = ['Pazar', 'Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi'];
            const date = new Date(dateStr);
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}, ${days[date.getDay()]}`;
        }

        function getDateParts(dateStr) {
            const months = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
            const days = ['Paz', 'Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt'];
            const date = new Date(dateStr);
            return {
                dayNumber: date.getDate(),
                month: months[date.getMonth()],
                weekday: days[date.getDay()]
            };
        }

        function startQuest() {
            const startDate = document.getElementById('startDateInput').value;
            const habit = document.getElementById('habitInput').value.trim();
            const reward = document.getElementById('rewardInput').value.trim();
            
            if (!startDate || !habit || !reward) {
                alert('Lütfen tüm alanları doldurun!');
                return;
            }
            
            // Create new quest
            const questId = generateQuestId();
            
            gameState.id = questId;
            gameState.habitGoal = habit;
            gameState.bigReward = reward;
            gameState.startDate = startDate;
            gameState.createdAt = new Date().toISOString();
            gameState.lastUpdated = new Date().toISOString();
            
            const start = new Date(startDate);
            const end = new Date(start);
            end.setDate(start.getDate() + 48);
            gameState.endDate = end.toISOString().split('T')[0];
            
            initializeDays();
            
            // Add to active quests
            multiQuestData.activeQuests.push({...gameState});
            multiQuestData.currentQuestId = questId;
            saveMultiQuestData();
            
            // Show game screen
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('backButton').classList.add('active');
            
            renderGame();
        }

        function initializeDays() {
            gameState.days = [];
            const start = new Date(gameState.startDate);
            
            for (let i = 0; i < 49; i++) {
                const date = new Date(start);
                date.setDate(start.getDate() + i);
                gameState.days.push({
                    date: date.toISOString().split('T')[0],
                    status: 'pending',
                    dayNumber: i + 1
                });
            }
        }

        function renderGame() {
            document.getElementById('questTitle').textContent = `⚔️ ${gameState.habitGoal}`;
            document.getElementById('rewardText').textContent = `🏆 Ödül: ${gameState.bigReward}`;
            document.getElementById('dateInfo').innerHTML = `📅 Başlangıç: ${formatDateFull(gameState.startDate)}<br>🎯 Hedef Bitiş: ${formatDateFull(gameState.endDate)}`;
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').innerHTML = formatDateFull(today).replace(', ', '<br>');
            
            document.getElementById('jokerCount').textContent = gameState.jokerCount;
            document.getElementById('streakCount').textContent = gameState.currentStreak;
            
            const streakPercent = (gameState.currentStreak / 14) * 100;
            document.getElementById('streakBar').style.width = `${streakPercent}%`;
            document.getElementById('streakText').textContent = `${gameState.currentStreak}/14`;
            
            renderGrid();
            showAlerts();
        }

        function renderGrid() {
            const gridMap = document.getElementById('gridMap');
            gridMap.innerHTML = '';
            const today = new Date().toISOString().split('T')[0];
            
            gameState.days.forEach((day, index) => {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                
                const parts = getDateParts(day.date);
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'cell-day-number';
                dayNumber.textContent = parts.dayNumber;
                
                const month = document.createElement('div');
                month.className = 'cell-month';
                month.textContent = parts.month;
                
                const weekday = document.createElement('div');
                weekday.className = 'cell-weekday';
                weekday.textContent = parts.weekday;
                
                cell.appendChild(dayNumber);
                cell.appendChild(month);
                cell.appendChild(weekday);
                
                if (day.status === 'completed') {
                    cell.classList.add('completed');
                    const icon = document.createElement('div');
                    icon.className = 'status-icon';
                    icon.textContent = '✓';
                    cell.appendChild(icon);
                } else if (day.status === 'empty') {
                    cell.classList.add('empty');
                } else if (day.status === 'joker') {
                    cell.classList.add('joker');
                    const largeIcon = document.createElement('div');
                    largeIcon.className = 'joker-icon-large';
                    largeIcon.textContent = '🃏';
                    cell.appendChild(largeIcon);
                    const icon = document.createElement('div');
                    icon.className = 'status-icon';
                    icon.textContent = '🃏';
                    cell.appendChild(icon);
                } else if (day.status === 'seven-g') {
                    cell.classList.add('seven-g');
                    const icon = document.createElement('div');
                    icon.className = 'status-icon';
                    icon.textContent = '🔥';
                    cell.appendChild(icon);
                }
                
                if (day.date === today) {
                    cell.classList.add('today');
                }
                
                if (debugMode || day.date <= today) {
                    cell.onclick = () => openBottomSheet(index);
                } else {
                    cell.classList.add('locked');
                    const icon = document.createElement('div');
                    icon.className = 'status-icon';
                    icon.textContent = '🔒';
                    cell.appendChild(icon);
                }
                
                gridMap.appendChild(cell);
            });
        }

        function openBottomSheet(index) {
            // Test modunda veya overlay kapalıysa günler düzenlenebilir
            const overlayOpen = document.getElementById('gameOverlay').classList.contains('active');
            if (gameState.gameStatus !== 'active' && !debugMode && overlayOpen) return;
            
            selectedDayIndex = index;
            const day = gameState.days[index];
            
            document.getElementById('sheetTitle').textContent = `Gün ${day.dayNumber}`;
            document.getElementById('sheetSubtitle').textContent = formatDateFull(day.date);
            
            const optionsContainer = document.getElementById('sheetOptions');
            optionsContainer.innerHTML = '';
            
            const completedOption = createOption('✅', 'Görev Tamamlandı', 'Quest başarıyla tamamlandı', day.status === 'completed', () => setDayStatus(index, 'completed'));
            optionsContainer.appendChild(completedOption);
            
            // Empty option - special handling for day after joker
            let emptyOption;
            if (index > 0 && gameState.days[index - 1].status === 'joker') {
                // Day after joker - show warning but allow click
                emptyOption = createOption(
                    '❌', 
                    'Boş Geç', 
                    'Joker kullanılan günün ertesi günü boş geçilemez!<div class="option-warning">⚠️ Bu seçeneği tıklarsan 7G Görevi başlar!</div>', 
                    day.status === 'empty', 
                    () => {
                        // Set empty and trigger 7G directly
                        closeBottomSheet();
                        gameState.days[index].status = 'empty';
                        console.log('Day after joker set to empty - starting 7G directly');
                        start7GDirect();
                        saveGame();
                        renderGame();
                    }
                );
            } else {
                // Normal empty option
                emptyOption = createOption('❌', 'Boş Geç', 'Quest yapılmadı', day.status === 'empty', () => setDayStatus(index, 'empty'));
            }
            
            optionsContainer.appendChild(emptyOption);
            
            if (gameState.jokerCount > 0) {
                const canUseJoker = checkCanUseJoker(index);
                const jokerOption = createOption('🃏', 'Joker Kullan (Epic)', `Mevcut joker: ${gameState.jokerCount}`, day.status === 'joker', canUseJoker ? () => setDayStatus(index, 'joker') : null);
                
                if (!canUseJoker) {
                    jokerOption.classList.add('disabled');
                    jokerOption.querySelector('.option-desc').innerHTML = `Mevcut joker: ${gameState.jokerCount}<div class="option-warning">⚠️ Jokerler peş peşe kullanılamaz</div>`;
                }
                
                optionsContainer.appendChild(jokerOption);
            }
            
            if (day.status !== 'pending') {
                optionsContainer.appendChild(createOption('🔄', 'Sıfırla', 'Günü bekliyor durumuna getir', false, () => setDayStatus(index, 'pending')));
            }
            
            document.getElementById('bottomSheetOverlay').classList.add('active');
            document.getElementById('bottomSheet').classList.add('active');
        }

        function createOption(icon, title, desc, isActive, onClick) {
            const option = document.createElement('div');
            option.className = 'bottom-sheet-option';
            if (isActive) option.style.background = 'rgba(0, 255, 136, 0.25)';
            
            option.innerHTML = `
                <div class="option-icon">${icon}</div>
                <div class="option-content">
                    <div class="option-title">${title}</div>
                    <div class="option-desc">${desc}</div>
                </div>
            `;
            
            if (onClick) option.onclick = onClick;
            return option;
        }

        function checkCanUseJoker(index) {
            if (index > 0 && gameState.days[index - 1].status === 'joker') return false;
            if (index < gameState.days.length - 1 && gameState.days[index + 1].status === 'joker') return false;
            return true;
        }

        function setDayStatus(index, status) {
            const day = gameState.days[index];
            console.log(`Setting day ${index} (${day.date}) from ${day.status} to ${status}`);
            
            if (status === 'joker') {
                if (!checkCanUseJoker(index)) {
                    alert('⚠️ Jokerler peş peşe kullanılamaz!');
                    closeBottomSheet();
                    return;
                }
                gameState.jokerCount--;
            }
            
            if (day.status === 'joker' && status !== 'joker') {
                gameState.jokerCount++;
            }
            
            day.status = status;
            closeBottomSheet();
            
            recalculateStreak();
            
            // 7G aktifken "2 boş gün" kontrolü yapma - direkt check7GProgress
            if (!gameState.sevenGActive) {
                checkForTwoEmptyDays();
            }
            
            checkForStreakReward();
            check7GProgress();
            checkGameCompletion();
            
            saveGame();
            renderGame();
        }

        function closeBottomSheet() {
            document.getElementById('bottomSheetOverlay').classList.remove('active');
            document.getElementById('bottomSheet').classList.remove('active');
        }

        function recalculateStreak() {
            let streak = 0;
            let today;
            
            if (debugMode) {
                // Test modunda: En son completed/seven-g/joker/empty olan günü bul
                // (Pending olmayan en son gün)
                today = null;
                for (let i = gameState.days.length - 1; i >= 0; i--) {
                    if (gameState.days[i].status !== 'pending') {
                        today = gameState.days[i].date;
                        break;
                    }
                }
                // Hiç işaretlenmemişse ilk günü al
                if (!today) today = gameState.days[0].date;
            } else {
                // Normal modda: Gerçek bugün
                today = new Date().toISOString().split('T')[0];
            }
            
            // Bugünün index'ini bul
            let todayIndex = -1;
            for (let i = gameState.days.length - 1; i >= 0; i--) {
                if (gameState.days[i].date <= today) {
                    todayIndex = i;
                    break;
                }
            }
            
            console.log('Debug mode:', debugMode, 'Today:', today, 'TodayIndex:', todayIndex);
            
            if (todayIndex === -1) {
                gameState.currentStreak = 0;
                return;
            }
            
            // En son ödül verilen günü bul
            let lastRewardDate = null;
            if (gameState.streakRewards && gameState.streakRewards.length > 0) {
                // En son ödül verilen gün (array'in son elemanı)
                lastRewardDate = gameState.streakRewards[gameState.streakRewards.length - 1];
            }
            
            // Bugünden geriye doğru say, ama en son ödül gününde dur
            for (let i = todayIndex; i >= 0; i--) {
                const day = gameState.days[i];
                
                // Eğer bu gün en son ödül verilen günse, burada dur (o gün dahil değil)
                if (lastRewardDate && day.date === lastRewardDate) {
                    console.log(`Day ${i}: Last reward date - stopping here`);
                    break;
                }
                
                if (day.status === 'completed' || day.status === 'seven-g') {
                    streak++;
                    console.log(`Day ${i}: ${day.status} - streak now ${streak}`);
                } else if (day.status === 'joker') {
                    // Joker streak'i kesmez ama saymaz
                    console.log(`Day ${i}: joker - continuing`);
                    continue;
                } else if (day.status === 'empty') {
                    // Empty streak'i keser
                    console.log(`Day ${i}: empty - streak broken`);
                    break;
                } else if (day.status === 'pending') {
                    // Pending - henüz yapılmamış, streak burada duruyor
                    console.log(`Day ${i}: pending - streak stops here`);
                    break;
                }
            }
            
            gameState.currentStreak = streak;
            console.log('Final streak:', streak);
        }

        function checkForTwoEmptyDays() {
            // Test modunda: En son completed/seven-g/joker/empty olan günü bul
            let today;
            if (debugMode) {
                today = null;
                for (let i = gameState.days.length - 1; i >= 0; i--) {
                    if (gameState.days[i].status !== 'pending') {
                        today = gameState.days[i].date;
                        break;
                    }
                }
                if (!today) today = gameState.days[0].date;
            } else {
                today = new Date().toISOString().split('T')[0];
            }
            
            console.log('Checking for two empty days, today:', today);
            
            for (let i = 1; i < gameState.days.length; i++) {
                const prevDay = gameState.days[i - 1];
                const currDay = gameState.days[i];
                
                if (currDay.date > today) break;
                
                if (prevDay.status === 'empty' && currDay.status === 'empty') {
                    console.log('Found two empty days:', prevDay.date, currDay.date);
                    
                    if (gameState.pendingTwoEmptyDays === currDay.date) {
                        console.log('Already handled this pair');
                        continue;
                    }
                    
                    gameState.pendingTwoEmptyDays = currDay.date;
                    
                    // Eğer 7G daha önce kullanıldıysa ve joker yoksa → GAME OVER
                    if (gameState.sevenGUsed && gameState.jokerCount === 0) {
                        console.log('7G already used and no joker - GAME OVER');
                        gameOver('İki gün üst üste boş geçtiniz. 7G Görevi daha önce kullanıldı ve jokeriniz yok. Quest başarısız!');
                        return;
                    }
                    
                    if (i >= 2 && gameState.days[i - 2].status === 'joker') {
                        console.log('Joker used 2 days ago, starting 7G directly');
                        start7GDirect();
                        return;
                    }
                    
                    if (gameState.jokerCount > 0) {
                        console.log('Showing joker modal, joker count:', gameState.jokerCount);
                        document.getElementById('modalJokerCount').textContent = gameState.jokerCount;
                        
                        // Eğer 7G daha önce kullanıldıysa, modalda sadece joker seçeneği olmalı
                        if (gameState.sevenGUsed) {
                            // Modal mesajını güncelle
                            document.querySelector('#jokerModal h2').textContent = '⚠️ İki Boş Gün!';
                            document.querySelector('#jokerModal p').innerHTML = 'İki gün üst üste boş geçtiniz. 7G Görevi daha önce kullanıldı.<br><strong>Joker kullanmalısınız, yoksa quest başarısız olur!</strong>';
                            // "7G Görevine Başla" butonunu gizle
                            document.querySelector('.modal-btn-no').style.display = 'none';
                        } else {
                            // Normal modal
                            document.querySelector('#jokerModal h2').textContent = '🃏 Joker Kullanmak İster Misiniz?';
                            document.querySelector('#jokerModal p').innerHTML = 'İki gün üst üste quest tamamlanmadı. Bir joker kullanarak devam edebilir veya 7G Kurtarma Görevi\'ne başlayabilirsiniz.<br><br><strong style="color: #ffd700;">Mevcut Joker: <span id="modalJokerCount">' + gameState.jokerCount + '</span></strong>';
                            document.querySelector('.modal-btn-no').style.display = 'inline-block';
                        }
                        
                        document.getElementById('jokerModal').classList.add('active');
                    } else {
                        console.log('No joker available, starting 7G directly');
                        start7GDirect();
                    }
                    return;
                }
            }
        }

        function useJokerAuto() {
            document.getElementById('jokerModal').classList.remove('active');
            
            const today = debugMode ? gameState.days[gameState.days.length - 1].date : new Date().toISOString().split('T')[0];
            for (let i = 1; i < gameState.days.length; i++) {
                if (gameState.days[i].date > today) break;
                
                if (gameState.days[i - 1].status === 'empty' && gameState.days[i].status === 'empty') {
                    gameState.days[i - 1].status = 'joker';
                    gameState.jokerCount--;
                    break;
                }
            }
            
            recalculateStreak();
            saveGame();
            renderGame();
        }

        function start7G() {
            document.getElementById('jokerModal').classList.remove('active');
            start7GDirect();
        }

        function start7GDirect() {
            console.log('Starting 7G Challenge');
            gameState.sevenGActive = true;
            gameState.sevenGProgress = 0;
            gameState.sevenGUsed = true;
            
            // 7G başladığı günü kaydet
            let today;
            if (debugMode) {
                today = null;
                for (let i = gameState.days.length - 1; i >= 0; i--) {
                    if (gameState.days[i].status !== 'pending') {
                        today = gameState.days[i].date;
                        break;
                    }
                }
                if (!today) today = gameState.days[0].date;
            } else {
                today = new Date().toISOString().split('T')[0];
            }
            
            gameState.sevenGStartDate = today; // 7G başladığı tarih
            
            const end = new Date(gameState.endDate);
            const curr = new Date(today);
            const daysRemaining = Math.ceil((end - curr) / (1000 * 60 * 60 * 24));
            
            if (daysRemaining < 7) {
                end.setDate(end.getDate() + 7);
                gameState.endDate = end.toISOString().split('T')[0];
                
                const lastDay = new Date(gameState.days[gameState.days.length - 1].date);
                for (let i = 1; i <= 7; i++) {
                    const newDate = new Date(lastDay);
                    newDate.setDate(lastDay.getDate() + i);
                    gameState.days.push({
                        date: newDate.toISOString().split('T')[0],
                        status: 'pending',
                        dayNumber: gameState.days.length + 1
                    });
                }
                
                console.log('+7 days added because less than 7 days remaining');
            }
            
            saveGame();
            renderGame();
        }

        function check7GProgress() {
            if (!gameState.sevenGActive) return;
            
            console.log('Checking 7G progress, start date:', gameState.sevenGStartDate);
            
            // 7G başladığı günü bul
            let startIndex = -1;
            for (let i = 0; i < gameState.days.length; i++) {
                if (gameState.days[i].date === gameState.sevenGStartDate) {
                    startIndex = i;
                    break;
                }
            }
            
            if (startIndex === -1) {
                console.error('7G start date not found!');
                return;
            }
            
            console.log('7G started at index:', startIndex);
            
            // 7G başladığı günden sonraki 7 günü kontrol et
            let sevenGCount = 0;
            let failed = false;
            
            for (let i = startIndex + 1; i < Math.min(startIndex + 8, gameState.days.length); i++) {
                const day = gameState.days[i];
                
                // Bu gün henüz gelmemişse (pending), devam et
                if (day.status === 'pending') {
                    console.log(`Day ${i} (${day.date}) is pending - waiting`);
                    break;
                }
                
                if (day.status === 'completed' || day.status === 'seven-g') {
                    if (day.status === 'completed') {
                        day.status = 'seven-g';
                    }
                    sevenGCount++;
                    console.log(`Day ${i} (${day.date}) completed - 7G count: ${sevenGCount}/7`);
                } else if (day.status === 'empty') {
                    console.log(`Day ${i} (${day.date}) is empty - 7G FAILED!`);
                    failed = true;
                    break;
                }
                
                if (sevenGCount >= 7) break;
            }
            
            if (failed) {
                gameOver('7G Kurtarma Görevi sırasında bir gün boş geçildi!');
                return;
            }
            
            gameState.sevenGProgress = sevenGCount;
            console.log('7G Progress:', sevenGCount, '/7');
            
            if (sevenGCount >= 7) {
                gameState.sevenGActive = false;
                gameState.sevenGProgress = 0;
                console.log('🎉 7G COMPLETED!');
                // Başarı mesajı göster (alert yerine daha güzel bir şey yapabiliriz)
            }
        }

        function checkForStreakReward() {
            console.log('Checking streak reward, current streak:', gameState.currentStreak);
            
            // Sadece streak 14'ün katlarında ödül ver (14, 28, 42...)
            if (gameState.currentStreak >= 14 && gameState.currentStreak % 14 === 0) {
                // Test modunda: En son completed/seven-g/joker/empty olan günü bul
                let today;
                if (debugMode) {
                    today = null;
                    for (let i = gameState.days.length - 1; i >= 0; i--) {
                        if (gameState.days[i].status !== 'pending') {
                            today = gameState.days[i].date;
                            break;
                        }
                    }
                    if (!today) today = gameState.days[0].date;
                } else {
                    today = new Date().toISOString().split('T')[0];
                }
                
                // Bugünkü günü bul
                let todayIndex = -1;
                for (let i = gameState.days.length - 1; i >= 0; i--) {
                    if (gameState.days[i].date === today) {
                        todayIndex = i;
                        break;
                    }
                }
                
                if (todayIndex === -1) return;
                
                const rewardDay = today;
                
                console.log('Streak is exactly', gameState.currentStreak, '- checking reward for:', rewardDay);
                
                // Eğer bu gün için daha önce ödül verilmediyse
                if (!gameState.streakRewards.includes(rewardDay)) {
                    gameState.jokerCount++;
                    gameState.streakRewards.push(rewardDay);
                    
                    console.log('REWARD GIVEN! New joker count:', gameState.jokerCount, '- Streak will reset on next recalculate');
                    
                    // KUTLAMA BAŞLAT!
                    showCelebration(todayIndex);
                } else {
                    console.log('Reward already given for today:', rewardDay);
                }
            }
        }

        function showCelebration(streak14DayIndex) {
            // Konfeti oluştur
            createConfetti();
            
            // Streak 14 gününü vurgula
            if (streak14DayIndex !== null) {
                setTimeout(() => {
                    const cells = document.querySelectorAll('.grid-cell');
                    if (cells[streak14DayIndex]) {
                        cells[streak14DayIndex].classList.add('streak-14');
                        
                        // 5 saniye sonra vurguyu kaldır
                        setTimeout(() => {
                            cells[streak14DayIndex].classList.remove('streak-14');
                        }, 5000);
                    }
                }, 500);
            }
            
            // Joker sayısına pulse animasyonu ekle
            const jokerEl = document.getElementById('jokerCount');
            jokerEl.classList.add('joker-pulse');
            setTimeout(() => jokerEl.classList.remove('joker-pulse'), 500);
            
            // Celebration overlay göster
            document.getElementById('celebrationOverlay').classList.add('active');
        }

        function closeCelebration() {
            document.getElementById('celebrationOverlay').classList.remove('active');
        }

        function createConfetti() {
            const colors = ['#ffd700', '#00ff88', '#00ffff', '#ff1493', '#ba55d3'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    document.body.appendChild(confetti);
                    
                    // Konfeti animasyon bitince temizle
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 10);
            }
        }

        function checkGameCompletion() {
            // Test modunda: En son işaretlenmiş günü al
            let today;
            if (debugMode) {
                today = null;
                for (let i = gameState.days.length - 1; i >= 0; i--) {
                    if (gameState.days[i].status !== 'pending') {
                        today = gameState.days[i].date;
                        break;
                    }
                }
                if (!today) today = gameState.days[0].date;
            } else {
                today = new Date().toISOString().split('T')[0];
            }
            
            let allCompleted = true;
            let totalDays = 0;
            let completedDays = 0;
            
            for (let day of gameState.days) {
                if (day.date > today) continue;
                totalDays++;
                
                if (day.status === 'completed' || day.status === 'joker' || day.status === 'seven-g') {
                    completedDays++;
                } else {
                    allCompleted = false;
                }
            }
            
            console.log('Game completion check:', completedDays, '/', totalDays, 'All completed:', allCompleted);
            
            // Eğer tüm günler tamamlandıysa (son güne kadar)
            if (allCompleted && totalDays === gameState.days.length) {
                console.log('🎉 QUEST COMPLETED!');
                gameState.gameStatus = 'success';
                saveGame();
                showSuccessOverlay();
            }
        }

        function showAlerts() {
            const container = document.getElementById('alertContainer');
            container.innerHTML = '';
            
            if (gameState.sevenGActive) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-7g';
                alert.innerHTML = `🔥 7G KURTARMA GÖREVİ AKTİF 🔥<br>Her gün tamamla! (${gameState.sevenGProgress}/7)`;
                container.appendChild(alert);
            }
        }

        function gameOver(reason) {
            gameState.gameStatus = 'failed';
            saveGame();
            
            document.getElementById('overlayTitle').textContent = '💀 QUEST BAŞARISIZ';
            document.getElementById('overlayMessage').textContent = reason;
            document.getElementById('overlayContent').className = 'overlay-content game-over';
            document.getElementById('gameOverlay').classList.add('active');
        }

        function showSuccessOverlay() {
            gameState.gameStatus = 'success';
            saveGame();
            
            // Konfeti!
            createConfetti();
            
            const totalDays = gameState.days.length;
            const message = `${totalDays} günlük macerayı tamamladınız!\n\n🏆 ${gameState.bigReward}`;
            
            document.getElementById('overlayTitle').textContent = '🎉 QUEST TAMAMLANDI!';
            document.getElementById('overlayMessage').textContent = message;
            document.getElementById('overlayContent').className = 'overlay-content success';
            document.getElementById('gameOverlay').classList.add('active');
            
            console.log('🎉 SUCCESS OVERLAY SHOWN with confetti!');
        }

        function closeOverlay() {
            document.getElementById('gameOverlay').classList.remove('active');
        }

        function closeOverlayWithAutoArchive() {
            // Otomatik arşivle
            if (multiQuestData.currentQuestId && (gameState.gameStatus === 'failed' || gameState.gameStatus === 'success')) {
                const completionRate = calculateCompletionRate();
                const archivedQuest = {
                    id: gameState.id,
                    habitGoal: gameState.habitGoal,
                    bigReward: gameState.bigReward,
                    startDate: gameState.startDate,
                    endDate: gameState.endDate,
                    status: gameState.gameStatus,
                    completionRate: completionRate,
                    archivedDate: new Date().toISOString().split('T')[0],
                    totalDays: gameState.days.length,
                    completedDays: gameState.days.filter(d => d.status === 'completed' || d.status === 'seven-g').length
                };
                
                // Remove from active quests
                multiQuestData.activeQuests = multiQuestData.activeQuests.filter(q => q.id !== multiQuestData.currentQuestId);
                
                // Add to archived quests
                multiQuestData.archivedQuests.unshift(archivedQuest);
                
                // currentQuestId'yi temizleme - kullanıcı takvimi görmek istiyor
                // multiQuestData.currentQuestId = null;
                
                saveMultiQuestData();
                console.log('Quest auto-archived:', archivedQuest.habitGoal);
            }
            
            // Sadece overlay'i kapat, takvimde kal
            closeOverlay();
        }

        function closeOverlayAndArchive() {
            // Move quest from active to archived
            if (multiQuestData.currentQuestId) {
                const completionRate = calculateCompletionRate();
                const archivedQuest = {
                    id: gameState.id,
                    habitGoal: gameState.habitGoal,
                    bigReward: gameState.bigReward,
                    startDate: gameState.startDate,
                    endDate: gameState.endDate,
                    status: gameState.gameStatus,
                    completionRate: completionRate,
                    archivedDate: new Date().toISOString().split('T')[0],
                    totalDays: gameState.days.length,
                    completedDays: gameState.days.filter(d => d.status === 'completed' || d.status === 'seven-g').length
                };
                
                // Remove from active quests
                multiQuestData.activeQuests = multiQuestData.activeQuests.filter(q => q.id !== multiQuestData.currentQuestId);
                
                // Add to archived quests
                multiQuestData.archivedQuests.unshift(archivedQuest);
                
                multiQuestData.currentQuestId = null;
                saveMultiQuestData();
            }
            
            // Go to dashboard
            showDashboard();
        }

        function archiveAndReturn() {
            // Quest'i arşive kaydet
            const completionRate = calculateCompletionRate();
            const quest = {
                habitGoal: gameState.habitGoal,
                bigReward: gameState.bigReward,
                startDate: gameState.startDate,
                endDate: gameState.endDate,
                status: gameState.gameStatus,
                completionRate: completionRate,
                archivedDate: new Date().toISOString().split('T')[0]
            };
            
            saveQuestToHistory(quest);
            
            // localStorage temizle ve yenile
            localStorage.removeItem('questTrackerData');
            location.reload();
        }

        function calculateCompletionRate() {
            let completed = 0;
            
            // Tüm quest boyunca tamamlanan günleri say
            for (let day of gameState.days) {
                if (day.status === 'completed' || day.status === 'joker' || day.status === 'seven-g') {
                    completed++;
                }
            }
            
            // Toplam gün sayısına göre yüzde hesapla
            const totalDays = gameState.days.length;
            return totalDays > 0 ? Math.round((completed / totalDays) * 100) : 0;
        }

        function getQuestHistory() {
            const history = localStorage.getItem('questHistory');
            return history ? JSON.parse(history) : [];
        }

        function saveQuestToHistory(quest) {
            const history = getQuestHistory();
            history.unshift(quest); // En yeni başa ekle
            localStorage.setItem('questHistory', JSON.stringify(history));
        }

        function deleteQuestFromHistory(index) {
            const history = getQuestHistory();
            history.splice(index, 1);
            localStorage.setItem('questHistory', JSON.stringify(history));
            renderHistory();
        }

        function showArchive() {
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('historyScreen').style.display = 'block';
            document.getElementById('backButton').classList.add('active');
            renderArchivedQuests();
        }

        function renderArchivedQuests() {
            const container = document.getElementById('historyList');
            
            if (multiQuestData.archivedQuests.length === 0) {
                container.innerHTML = '<div class="empty-history">Henüz tamamlanmış quest yok.</div>';
                return;
            }
            
            container.innerHTML = multiQuestData.archivedQuests.map((quest, index) => `
                <div class="history-item">
                    <div class="history-item-info">
                        <div class="history-item-title">${quest.habitGoal}</div>
                        <div class="history-item-date">${quest.startDate} - ${quest.endDate}</div>
                        <div class="history-item-stats">
                            <span class="history-stat ${quest.status === 'success' ? 'success' : 'failed'}">
                                ${quest.status === 'success' ? '✓ Başarılı' : '✗ Başarısız'}
                            </span>
                            <span class="history-stat">Doluluk: ${quest.completionRate}%</span>
                            <span class="history-stat">Tamamlanan: ${quest.completedDays || 0} gün</span>
                        </div>
                    </div>
                    <button class="btn-delete-history" onclick="deleteArchivedQuest(${index})">🗑️</button>
                </div>
            `).join('');
        }

        function deleteArchivedQuest(index) {
            const quest = multiQuestData.archivedQuests[index];
            if (!quest) return;
            
            pendingDeleteQuestId = 'archive-' + index; // Özel format ile kaydet
            
            const message = '"' + quest.habitGoal + '" quest\'ini arşivden silmek istediğinize emin misiniz?';
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
        }

        function deleteActiveQuest(questId) {
            const quest = multiQuestData.activeQuests.find(q => q.id === questId);
            if (!quest) return;
            
            const confirmMsg = `"${quest.habitGoal}" quest'ini silmek istediğinize emin misiniz?\n\nTüm ilerleme kaybolacak!`;
            
            if (confirm(confirmMsg)) {
                multiQuestData.activeQuests = multiQuestData.activeQuests.filter(q => q.id !== questId);
                
                // Eğer silinen quest şu an açıksa currentQuestId'yi temizle
                if (multiQuestData.currentQuestId === questId) {
                    multiQuestData.currentQuestId = null;
                }
                
                saveMultiQuestData();
                renderActiveQuests();
            }
        }

        function showHistory() {
            showArchive(); // Redirect to archive
        }

        function renderHistory() {
            const history = getQuestHistory();
            const container = document.getElementById('historyList');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-history">Henüz tamamlanmış macera yok.</div>';
                return;
            }
            
            container.innerHTML = history.map((quest, index) => `
                <div class="history-item">
                    <div class="history-item-info">
                        <div class="history-item-title">${quest.habitGoal}</div>
                        <div class="history-item-date">${quest.startDate} - ${quest.endDate}</div>
                        <div class="history-item-stats">
                            <span class="history-stat ${quest.status === 'success' ? 'success' : 'failed'}">
                                ${quest.status === 'success' ? '✓ Başarılı' : '✗ Başarısız'}
                            </span>
                            <span class="history-stat">Doluluk: ${quest.completionRate}%</span>
                        </div>
                    </div>
                    <button class="btn-delete-history" onclick="deleteQuestFromHistory(${index})">🗑️</button>
                </div>
            `).join('');
        }

        function backToSetup() {
            goToDashboard();
        }

        function startNewQuest() {
            // Archive current quest and go to dashboard
            if (multiQuestData.currentQuestId) {
                closeOverlayAndArchive();
            } else {
                showNewQuestSetup();
            }
        }

        function resetGame() {
            if (confirm('⚠️ TÜM questler silinecek! Emin misiniz?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function saveGame() {
            // Save current quest to multi-quest system
            if (multiQuestData.currentQuestId) {
                saveCurrentQuest();
                saveMultiQuestData();
            }
            // Keep old localStorage for backwards compatibility
            localStorage.setItem('questTrackerData', JSON.stringify(gameState));
        }

        // Multi-Quest System Functions
        function loadMultiQuestData() {
            const saved = localStorage.getItem('multiQuestData');
            if (saved) {
                multiQuestData = JSON.parse(saved);
            }
        }

        function saveMultiQuestData() {
            localStorage.setItem('multiQuestData', JSON.stringify(multiQuestData));
        }

        function generateQuestId() {
            return 'quest-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        function showDashboard() {
            // Hide all screens
            document.getElementById('dashboardScreen').style.display = 'block';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('historyScreen').style.display = 'none';
            document.getElementById('backButton').classList.remove('active');
            
            renderActiveQuests();
        }

        function renderActiveQuests() {
            const container = document.getElementById('activeQuestsContainer');
            
            if (multiQuestData.activeQuests.length === 0) {
                container.innerHTML = `
                    <div class="empty-dashboard">
                        <h2>🎯 Henüz Aktif Quest Yok</h2>
                        <p>Yeni bir quest başlatarak 49 günlük alışkanlık maceranıza başlayın!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <h2 style="color: #00ff88; margin-bottom: 20px; font-size: 1.5em;">📋 Aktif Questler</h2>
                <div class="quest-grid" id="questGrid">
                    ${multiQuestData.activeQuests.map(quest => renderQuestCard(quest)).join('')}
                </div>
            `;
            
            // Setup click handlers
            setupQuestCardHandlers();
        }

        function setupQuestCardHandlers() {
            const grid = document.getElementById('questGrid');
            if (!grid) return;
            
            grid.addEventListener('click', (e) => {
                const card = e.target.closest('.quest-card');
                if (!card) return;
                
                const questId = card.getAttribute('data-quest-id');
                
                // Check if delete button was clicked
                if (e.target.closest('.btn-delete-quest')) {
                    e.stopPropagation();
                    handleDeleteQuest(questId);
                } else {
                    openQuest(questId);
                }
            });
        }

        let pendingDeleteQuestId = null;

        function handleDeleteQuest(questId) {
            const quest = multiQuestData.activeQuests.find(q => q.id === questId);
            if (!quest) return;
            
            pendingDeleteQuestId = questId;
            
            const message = '"' + quest.habitGoal + '" quest\'ini silmek istediğinize emin misiniz?\n\nTüm ilerleme kaybolacak!';
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
        }

        function confirmDeleteQuest() {
            if (!pendingDeleteQuestId) return;
            
            // Arşiv silme mi?
            if (pendingDeleteQuestId.startsWith('archive-')) {
                const index = parseInt(pendingDeleteQuestId.replace('archive-', ''));
                multiQuestData.archivedQuests.splice(index, 1);
                saveMultiQuestData();
                renderArchivedQuests();
                console.log('Archived quest deleted at index:', index);
            } else {
                // Aktif quest silme
                multiQuestData.activeQuests = multiQuestData.activeQuests.filter(q => q.id !== pendingDeleteQuestId);
                
                if (multiQuestData.currentQuestId === pendingDeleteQuestId) {
                    multiQuestData.currentQuestId = null;
                }
                
                saveMultiQuestData();
                renderActiveQuests();
                console.log('Active quest deleted:', pendingDeleteQuestId);
            }
            
            closeConfirmModal();
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            pendingDeleteQuestId = null;
        }

        // Setup confirm modal buttons
        function setupConfirmModal() {
            document.getElementById('btnConfirmYes').addEventListener('click', confirmDeleteQuest);
            document.getElementById('btnConfirmNo').addEventListener('click', closeConfirmModal);
        }

        function renderQuestCard(quest) {
            const completionRate = calculateQuestCompletion(quest);
            const daysPassed = quest.days.filter(d => d.status !== 'pending').length;
            const today = new Date().toISOString().split('T')[0];
            let totalDays = 0;
            for (let day of quest.days) {
                if (day.date <= today) totalDays++;
            }
            
            let statusClass = 'active';
            let statusText = '🎮 Devam Ediyor';
            
            if (quest.gameStatus === 'success') {
                statusClass = 'success';
                statusText = '✅ Başarılı';
            } else if (quest.gameStatus === 'failed') {
                statusClass = 'failed';
                statusText = '❌ Başarısız';
            }

            return `
                <div class="quest-card ${statusClass}" data-quest-id="${quest.id}">
                    <div class="quest-card-header">
                        <div class="quest-title-card">${quest.habitGoal}</div>
                        <button class="btn-delete-quest" data-quest-id="${quest.id}" title="Quest'i Sil">🗑️</button>
                    </div>
                    <div class="quest-reward-card">🏆 Ödül: ${quest.bigReward}</div>
                    <div class="quest-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${completionRate}%">
                                ${completionRate}%
                            </div>
                        </div>
                    </div>
                    <div class="quest-stats">
                        <span>📅 ${daysPassed}/${quest.days.length} gün</span>
                        <span>🃏 ${quest.jokerCount} Joker</span>
                        <span>⚡ ${quest.currentStreak} Streak</span>
                        <span>🗓️ ${quest.startDate}</span>
                        ${quest.sevenGActive ? '<span style="color: #ffa500;">🔥 7G Aktif</span>' : ''}
                    </div>
                </div>
            `;
        }

        function calculateQuestCompletion(quest) {
            let completed = 0;
            
            // Tamamlanan günleri say
            for (let day of quest.days) {
                if (day.status === 'completed' || day.status === 'joker' || day.status === 'seven-g') {
                    completed++;
                }
            }
            
            // Toplam gün sayısı (7G ile uzamış olabilir)
            const totalDays = quest.days.length;
            return totalDays > 0 ? Math.round((completed / totalDays) * 100) : 0;
        }

        function showNewQuestSetup() {
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('backButton').classList.add('active');
            document.getElementById('startDateInput').value = new Date().toISOString().split('T')[0];
        }

        function openQuest(questId) {
            // Load quest data into gameState
            const quest = multiQuestData.activeQuests.find(q => q.id === questId);
            if (!quest) return;
            
            multiQuestData.currentQuestId = questId;
            gameState = {...quest};
            
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('backButton').classList.add('active');
            
            if (gameState.gameStatus === 'success') {
                showSuccessOverlay();
            } else if (gameState.gameStatus === 'failed') {
                gameOver(gameState.failReason || 'Quest başarısız oldu.');
            }
            
            saveMultiQuestData();
            renderGame();
        }

        function goToDashboard() {
            // Save current quest before going back
            if (multiQuestData.currentQuestId) {
                saveCurrentQuest();
            }
            
            multiQuestData.currentQuestId = null;
            saveMultiQuestData();
            showDashboard();
        }

        function saveCurrentQuest() {
            if (!multiQuestData.currentQuestId) return;
            
            const index = multiQuestData.activeQuests.findIndex(q => q.id === multiQuestData.currentQuestId);
            if (index !== -1) {
                multiQuestData.activeQuests[index] = {...gameState};
                multiQuestData.activeQuests[index].lastUpdated = new Date().toISOString();
            }
        }

        // Tab switching functions (deprecated - now using modals)
        function showRulesTab() {
            // Not used anymore
        }

        function showMotivationTab() {
            // Not used anymore
        }

        // Info Modal Functions
        function openRulesModal() {
            const content = `
                <h2>📋 Nasıl Çalışır?</h2>
                <p style="margin-bottom: 15px; color: #00ff88; font-weight: 600; font-size: 1.1em;">49 günlük alışkanlık yolculuğunu başlat, zinciri koru!</p>
                <ul class="rules-list" style="margin-bottom: 20px;">
                    <li>Kendine sürdürülebilir bir günlük hedef belirle.</li>
                    <li>Asla iki gün üst üste boş geçirme.</li>
                    <li>Bir gün boş geçersen ertesi gün mutlaka tamamla.</li>
                    <li>Başlangıçta 1 joker hakkın vardır.</li>
                    <li>14 gün kesintisiz tamamlarsan 1 ek joker kazanırsın.</li>
                    <li>Jokerler peş peşe kullanılamaz ve yalnızca hedefin iptal olmasını engeller.</li>
                </ul>
                <p style="margin: 15px 0; line-height: 1.7; color: #e0e0e0;">
                    İki gün üst üste boş geçersen sistem sana bir defaya mahsus <strong style="color: #ffa500;">7 Gün Peş Peşe Tamamlama</strong> görevi verir. Bu görevi eksiksiz tamamlarsan devam edersin; tamamlayamazsan hedef iptal olur.
                </p>
                <p style="margin-bottom: 20px; line-height: 1.7; color: #e0e0e0;">
                    Takvim yetersiz kalırsa sistem süreyi otomatik olarak 1 hafta uzatır.
                </p>
                <p style="color: #00ff88; font-weight: 600; text-align: center; margin: 25px 0 15px 0; font-size: 1.2em;">
                    Disiplin + Esneklik = Kalıcı Alışkanlık
                </p>
                <p style="text-align: center; color: #a0a0a0; font-style: italic; font-size: 1.05em;">
                    Kendin için verdiğin sözü tutmaya hazır mısın?
                </p>
            `;
            document.getElementById('infoModalContent').innerHTML = content;
            document.getElementById('infoModal').classList.add('active');
        }

        function openMotivationModal() {
            const content = `
                <h2>💪 Motivasyon</h2>
                <p style="margin-bottom: 20px; line-height: 1.8; color: #e0e0e0; font-size: 1.05em;">
                    <strong style="color: #ff4444;">Bir günü kaçırmak zayıflık değildir.</strong> Ama <strong style="color: #ff4444;">iki gün üst üste kaçırmak bir tercihtir.</strong>
                </p>
                <p style="margin-bottom: 20px; line-height: 1.8; color: #e0e0e0; font-size: 1.05em;">
                    Beyin tekrar etmeye programlıdır. Tekrar ettiğin şeyi güçlendirir, etmediğini siler. <strong style="color: #00ff88;">Disiplin, motivasyonun olmadığı günlerde devreye girer.</strong> Alışkanlık; istekle değil, istikrarla inşa edilir.
                </p>
                <p style="margin-bottom: 20px; line-height: 1.8; color: #e0e0e0; font-size: 1.05em;">
                    Bu sistem seni rahatlatmak için değil, <strong style="color: #ffd700;">güçlendirmek için tasarlandı.</strong> Jokerler bahane değil, sorumluluk hatırlatıcısıdır. 7 günlük görev ceza değil, karakter testidir.
                </p>
                <p style="line-height: 1.8; color: #00ff88; font-weight: 600; text-align: center; margin: 30px 0 15px 0; font-size: 1.2em;">
                    Kurallar basit: İki gün üst üste vazgeçme. Zinciri koru.
                </p>
                <p style="text-align: center; color: #a0a0a0; font-style: italic; font-size: 1.05em;">
                    Çünkü karakter, tekrar eden davranışların toplamıdır.
                </p>
            `;
            document.getElementById('infoModalContent').innerHTML = content;
            document.getElementById('infoModal').classList.add('active');
        }

        function closeInfoModal() {
            document.getElementById('infoModal').classList.remove('active');
        }

        function openAboutModal() {
            const content = `
                <div class="about-content">
                    <h2>ℹ️ Hakkında</h2>
                    
                    <div style="font-size: 3em; margin: 20px 0;">2Days</div>
                    
                    <div class="version">Versiyon 26.02</div>
                    
                    <div class="developer">
                        <strong>Geliştirici:</strong><br>
                        Murat Şimşekoğlu
                    </div>
                    
                    <div class="contact">
                        📧 <a href="mailto:m.simsekoglu@gmail.com">m.simsekoglu@gmail.com</a>
                    </div>
                    
                    <div style="margin-top: 30px; color: #a0a0a0; font-style: italic; line-height: 1.6;">
                        "Disiplin + Esneklik = Kalıcı Alışkanlık"<br>
                        <span style="font-size: 0.9em;">Miss once, never twice</span>
                    </div>
                    
                    <div class="data-management">
                        <h3 style="color: #00ff88; margin-bottom: 15px;">💾 Veri Yönetimi</h3>
                        <p style="color: #a0a0a0; font-size: 0.95em; margin-bottom: 15px;">Verilerinizi yedekleyin veya başka cihaza aktarın</p>
                        <div class="data-buttons">
                            <button class="btn-export" onclick="exportData()">📥 Dışa Aktar</button>
                            <button class="btn-import" onclick="document.getElementById('importFile').click()">📤 İçe Aktar</button>
                        </div>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                        <div id="dataStatus" style="margin-top: 15px; color: #00ff88; font-weight: 600; text-align: center;"></div>
                    </div>
                    
                    <div class="test-mode-section">
                        <h3 style="color: #ffa500; margin-bottom: 15px;">🔧 Test Modu</h3>
                        <p style="color: #a0a0a0; font-size: 0.95em; margin-bottom: 15px;">Geliştirici modu - Şifre gerekli</p>
                        <div class="test-mode-input">
                            <input type="password" id="testModePassword" placeholder="Şifre girin" onkeypress="if(event.key==='Enter') toggleTestModeWithPassword()">
                            <button onclick="toggleTestModeWithPassword()">Aktifleştir</button>
                        </div>
                        <div id="testModeStatus" style="margin-top: 15px; color: #00ff88; font-weight: 600;"></div>
                    </div>
                </div>
            `;
            document.getElementById('infoModalContent').innerHTML = content;
            document.getElementById('infoModal').classList.add('active');
        }

        function toggleTestModeWithPassword() {
            const password = document.getElementById('testModePassword').value;
            const correctPassword = "Mm.084134";
            const statusDiv = document.getElementById('testModeStatus');
            
            if (password === correctPassword) {
                debugMode = !debugMode;
                localStorage.setItem('debugMode', debugMode);
                
                if (debugMode) {
                    statusDiv.innerHTML = '✅ Test Modu Aktif<br><button onclick="resetAllDays()" style="margin-top: 15px; padding: 10px 25px; background: linear-gradient(135deg, #ff4444, #cc0000); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">🔄 Tüm Günleri Sıfırla</button>';
                    statusDiv.style.color = '#00ff88';
                } else {
                    statusDiv.textContent = '❌ Test Modu Kapalı';
                    statusDiv.style.color = '#ff4444';
                }
                
                // Reload the current screen to show/hide test mode UI
                if (document.getElementById('gameScreen').style.display === 'block') {
                    renderGame();
                }
                
                console.log('Test mode toggled:', debugMode);
            } else {
                statusDiv.textContent = '❌ Hatalı Şifre';
                statusDiv.style.color = '#ff4444';
            }
        }

        function resetAllDays() {
            if (!debugMode) return;
            
            console.log('Resetting all days...');
            for (let d of gameState.days) {
                d.status = 'pending';
            }
            gameState.currentStreak = 0;
            gameState.sevenGActive = false;
            gameState.sevenGProgress = 0;
            gameState.sevenGUsed = false;
            gameState.sevenGStartDate = null;
            gameState.jokerCount = 1;
            gameState.streakRewards = [];
            
            saveGame();
            renderGame();
            
            document.getElementById('testModeStatus').innerHTML = '✅ Test Modu Aktif - Tüm günler sıfırlandı!<br><button onclick="resetAllDays()" style="margin-top: 15px; padding: 10px 25px; background: linear-gradient(135deg, #ff4444, #cc0000); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">🔄 Tüm Günleri Sıfırla</button>';
        }

        // Export/Import Functions
        function exportData() {
            const data = {
                multiQuestData: multiQuestData,
                debugMode: debugMode,
                exportDate: new Date().toISOString(),
                version: "26.02"
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `2days-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            const statusDiv = document.getElementById('dataStatus');
            statusDiv.textContent = '✅ Veriler başarıyla dışa aktarıldı!';
            statusDiv.style.color = '#00ff88';
            setTimeout(() => statusDiv.textContent = '', 3000);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate data
                    if (!data.multiQuestData || !data.version) {
                        throw new Error('Geçersiz yedekleme dosyası');
                    }
                    
                    // Import data
                    multiQuestData = data.multiQuestData;
                    debugMode = data.debugMode || false;
                    
                    // Save to localStorage
                    localStorage.setItem('multiQuestData', JSON.stringify(multiQuestData));
                    localStorage.setItem('debugMode', debugMode);
                    
                    const statusDiv = document.getElementById('dataStatus');
                    statusDiv.textContent = '✅ Veriler başarıyla içe aktarıldı! Sayfa yenileniyor...';
                    statusDiv.style.color = '#00ff88';
                    
                    // Reload page after 1 second
                    setTimeout(() => location.reload(), 1000);
                    
                } catch (error) {
                    const statusDiv = document.getElementById('dataStatus');
                    statusDiv.textContent = '❌ Hata: ' + error.message;
                    statusDiv.style.color = '#ff4444';
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function loadGame() {
            loadMultiQuestData();
            setupConfirmModal();
            
            // Always show dashboard first
            showDashboard();
        }

        loadGame();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('✅ PWA: Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('❌ PWA: Service Worker registration failed:', error);
                    });
            });
        }

        // Install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('💡 PWA: Install prompt available');
        });
    </script>
    <!-- Footer -->
    <div class="app-footer">
        <button class="footer-button" onclick="openAboutModal()">ℹ️ Hakkında</button>
    </div>

</body>
</html>
